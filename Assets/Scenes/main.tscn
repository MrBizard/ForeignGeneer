[gd_scene load_steps=24 format=3 uid="uid://dvxxm2v6se3nl"]

[ext_resource type="Texture2D" uid="uid://c52qj3y33m53b" path="res://Assets/Map/Scene/light-blue-polygon-abstract-backdrop-vector.png" id="1_3puoc"]
[ext_resource type="PackedScene" uid="uid://cbre4uav8lugb" path="res://Assets/Prefabs/Characters_rigging.tscn" id="1_6t2fw"]
[ext_resource type="Script" path="res://Assets/Scripts/Player/Player.cs" id="2_qehyv"]
[ext_resource type="Script" path="res://Assets/Scripts/Manager.cs" id="4_gc2hg"]
[ext_resource type="Script" path="res://Assets/Map/ResourceGeneration.cs" id="6_mtmf7"]
[ext_resource type="Script" path="res://VoronoiBiome/BiomeManager.cs" id="6_pufo3"]
[ext_resource type="Script" path="res://addons/terrabrush/TerraBrush.cs" id="7_2pj54"]
[ext_resource type="Texture2D" uid="uid://bgvw6g3owr58x" path="res://Assets/Scenes/Main/Heightmap_0_0.res" id="8_egevk"]
[ext_resource type="Script" path="res://Assets/Scripts/Player/PlayerInventory.cs" id="8_k76vs"]
[ext_resource type="Resource" uid="uid://cu2pp2dngusxl" path="res://Assets/Map/Grass.tres" id="8_u47is"]
[ext_resource type="Script" path="res://addons/terrabrush/Scripts/EditorResources/ZoneResource.cs" id="9_3onbg"]
[ext_resource type="Texture2D" path="res://Assets/Scenes/Main/Splatmap_0_0_0.res" id="10_laou3"]
[ext_resource type="Script" path="res://addons/terrabrush/Scripts/EditorResources/ZonesResource.cs" id="10_o0cp4"]
[ext_resource type="PackedScene" uid="uid://c0bt6tipueu6w" path="res://Assets/Map/Scene/Ocean.tscn" id="13_uj2kw"]
[ext_resource type="Script" path="res://Assets/Scenes/CollisionFit.cs" id="14_8gcg8"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_wmmy8"]
sky_top_color = Color(0.310569, 0.430626, 0.74474, 1)
sky_horizon_color = Color(0.532021, 0.667144, 0.832527, 1)
sky_curve = 0.243676
sky_cover = ExtResource("1_3puoc")
sun_angle_max = 42.27
sun_curve = 0.191184

[sub_resource type="Sky" id="Sky_xs082"]
sky_material = SubResource("ProceduralSkyMaterial_wmmy8")

[sub_resource type="Environment" id="Environment_wvy0c"]
background_mode = 2
sky = SubResource("Sky_xs082")

[sub_resource type="Shader" id="Shader_muhn0"]
code = "shader_type spatial;
render_mode cull_back, blend_mix, depth_draw_opaque, diffuse_burley, specular_schlick_ggx;

#include \"res://addons/terrabrush/Resources/Shaders/heightmap_clipmap_shader_include.gdshaderinc\"

varying vec3 _worldVertex;

void vertex() {
	_worldVertex = vec3(0);
	calculateHeightmapVertex(MODEL_MATRIX, COLOR, VERTEX, NORMAL, _worldVertex);
}

void fragment() {
    // Calculate the base terrain properties using the TerraBrush function
    vec3 albedo_color = vec3(0.0); // Use vec3 for ALBEDO
    vec3 normal_map = vec3(0.0);
    float roughness = 0.0;
    float alpha = 1.0;
    float alpha_scissor_threshold = 0.0;

    calculateHeightmapFragment(
        _worldVertex,
        albedo_color, // Passed as vec3
        normal_map,
        roughness,
        alpha,
        alpha_scissor_threshold
    );

    // Output the final values
    ALBEDO = albedo_color; // ALBEDO is a vec3
    NORMAL_MAP = normal_map;
    ROUGHNESS = roughness;
    ALPHA = alpha; // Alpha is handled separately
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_lghg2"]
render_priority = 0
shader = SubResource("Shader_muhn0")
shader_parameter/InitialCellWidth = 1.0
shader_parameter/OffsetPosition = null
shader_parameter/ZonesSize = null
shader_parameter/Resolution = null
shader_parameter/NumberOfZones = null
shader_parameter/ApplyLockTextures = false
shader_parameter/WaterFactor = 1.0
shader_parameter/TexturesDetail = null
shader_parameter/NumberOfTextures = null
shader_parameter/HasNormalTextures = null
shader_parameter/HasRoughnessTextures = null
shader_parameter/HasHeightTextures = null
shader_parameter/UseAntitile = true
shader_parameter/BlendFactor = null
shader_parameter/NearestFilter = false
shader_parameter/AlbedoAlphaChannelUsage = 0
shader_parameter/NormalAlphaChannelUsage = 0

[sub_resource type="Resource" id="Resource_scupb"]
script = ExtResource("9_3onbg")
ZonePosition = Vector2i(0, 0)
HeightMapTexture = ExtResource("8_egevk")
SplatmapsTexture = [ExtResource("10_laou3")]
FoliagesTexture = []
ObjectsTexture = []

[sub_resource type="Resource" id="Resource_ilplf"]
script = ExtResource("10_o0cp4")
Zones = [SubResource("Resource_scupb")]

[sub_resource type="HeightMapShape3D" id="HeightMapShape3D_rd4th"]

[node name="Main" type="Node3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -36.4484, 0)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_wvy0c")

[node name="Player_Character" parent="." node_paths=PackedStringArray("Map") instance=ExtResource("1_6t2fw")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
script = ExtResource("2_qehyv")
Map = NodePath("../TerraBrush")

[node name="Manager" type="Node" parent="."]
script = ExtResource("4_gc2hg")

[node name="Ingot" type="Node" parent="Manager"]

[node name="Inventory Manager" type="Control" parent="Manager"]
layout_mode = 3
anchors_preset = 0

[node name="Container" type="Container" parent="Manager/Inventory Manager"]
layout_mode = 1
anchors_preset = -1
anchor_right = 0.036
anchor_bottom = 0.063
offset_right = -0.472004
offset_bottom = 0.175999
script = ExtResource("8_k76vs")

[node name="ColorRect" type="ColorRect" parent="Manager/Inventory Manager/Container"]
layout_mode = 2
color = Color(0.884703, 0.260816, 0.716615, 1)

[node name="BiomeManager" type="Node3D" parent="Manager"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -36.4484, 0)
script = ExtResource("6_pufo3")

[node name="ObjectSpawner" type="Node3D" parent="Manager" node_paths=PackedStringArray("Map")]
script = ExtResource("6_mtmf7")
Map = NodePath("../../TerraBrush")

[node name="DroppedItem3D" type="Node3D" parent="."]

[node name="TerraBrush" type="Node3D" parent="."]
script = ExtResource("7_2pj54")
ZonesSize = 2049
Resolution = 4
DataPath = "res://Assets/Scenes/Main"
CustomShader = SubResource("ShaderMaterial_lghg2")
LODInitialCellWidth = 4.0
TextureSets = ExtResource("8_u47is")
Foliages = []
Objects = []
TerrainZones = SubResource("Resource_ilplf")
metadata/_edit_lock_ = true

[node name="StaticBody3D" type="StaticBody3D" parent="TerraBrush"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="TerraBrush/StaticBody3D"]
shape = SubResource("HeightMapShape3D_rd4th")
script = ExtResource("14_8gcg8")

[node name="MeshInstance3D" parent="TerraBrush" instance=ExtResource("13_uj2kw")]
transform = Transform3D(9000, 0, 0, 0, 0.5, 0, 0, 0, 9000, 0, -10, 0)
skeleton = NodePath("")
